# 1.4 使用Java Servlet编写API

更新日期：2020-4-20

-------------------------------------  

## 1. 定义API接口

我认为要想编写API，就得先定好如何使用API。

对于一个开发人员来说。我们当然是希望能像调用本地Jar包里的工具类函数一样方便的调用网络上开放的API。也就是一条简单的调用语句，然后收到一条返回值。返回值里可以存放任何我们想要的数据。当然调用语句可以随心所有的传递参数。

为了达到这种效果。我们先来具体看一下该如何定义一个API。

假设我们像这样调用一个本地API函数:

```java
UserInfor userInfo = LocalAPI.lookUpUserInfo("Li Lei", 20);
```

为了达到类似的效果，我们来简单的设计一下。

!!! example "设计例子"

    __(1) 简单的调用__

        get     https://localhost/myapi/lookUpUserInfo
        post    https://localhost/myapi/lookUpUserInfo

    只要你会发http请求，就能调用。

    __(2) 传递参数__

    通过HTTP请求体传递。这个请求体里可以放任何内容。比如我们约定请求体里面放的内容格式是json串。那么可以像下面这样指定参数:

    ```json
    {
        "name":"Li Lei",
        "age": 20
    }
    ```

    __(3) 接受返回值__

    可以通过response对象得到HTTP响应的响应体。假如我们同样约定本函数使用json串来返回数据。那它的响应体可以设计成下面这样:

    ```json
    {
        "name":"Li Lei",
        "age": 20,
        "math_score": 120,
        "english_score": 145,
        ... ...
    }
    ```

    这个返回结果任何人都能轻易处理。
    实际上HTTP响应体里可以放任何数据，任何二进制数据。比如一张图片，一个压缩包。

## 2. 实现API接口

使用Java Servlet实现这样一个接口非常容易，你只需要在你的web工程myapi中定义这样一个类，然后发布你的工程，就完了:

```java
@WebServlet("/lookUpUserInfo")
public class UserInfoAPI extends HttpServlet {
    
    @Override
    protected void doGet(request, response) … {
        
        //从request中取出请求体中的json串
        // 从json串中取出参数name和age
        
        //  业务处理
        
        //  处理结果转为json串
        //  将json串写入响应体
    }
```

doPost也是一样的道理。

WebServlet注解是Servlet 3.0版本中新提供的注解。这样写很方便，省去了在web.xml中配置servlet的繁琐过程。

这个类也可以不放在Web工程中，放在web工程引用的Jar工程中也一样。
